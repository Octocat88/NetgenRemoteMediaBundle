{% block ezplatform_fieldtype_ngremotemedia_widget %}
    {% set field = form.parent.vars.value.field %}
    {% set field_value = form.parent.vars.value.value %}

    {% set type = field_value.metaData.resource_type|default('image') %}

    {% set croppableVariations = ngrm_available_variations(app.request.attributes.get('contentTypeIdentifier'), true)  %}
    {% set availableVariations = croppableVariations|scaling_format|json_encode %}

    {% include '@NetgenRemoteMedia/ezadminui/js_templates.html.twig' with {
        'paths': {
            'browse': path('netgen_remote_media_ezadmin_browse'),
            'folders': path('netgen_remote_media_ezadmin_folders')
        },
        'available_variations': availableVariations,
        'fieldId': field.id
    } %}

    <div class="ngremotemedia-type" data-id="{{ field.id }}">
        {% include '@NetgenRemoteMedia/ezadminui/field/edit/preview.html.twig' %}
        {% include '@NetgenRemoteMedia/ezadminui/field/edit/interactions.html.twig' %}

        {{ form_row(form.media_type, { 'attr': {'v-model': 'selectedImage.type'} }) }}

        {{ form_row(form.image_variations, { 'attr': {'class' : 'media-id', 'v-model': 'stringifiedVariations'} }) }}
        <crop-modal v-if="cropModalOpen" @change="handleVariationCropChange" @close="handleCropModalClose" :selected-image="selectedImage" :available-variations="config.availableVariations"></crop-modal>
        <media-modal :folders="folders" :selected-media-id="selectedImage.id" v-if="mediaModalOpen" @close="handleMediaModalClose" @media-selected="handleMediaSelected" :paths="config.paths"></media-modal>
        <upload-modal :folders="folders" v-if="uploadModalOpen" @close="handleUploadModalClose" @save="handleUploadModalSave" :loading="uploadModalLoading" :name="selectedImage.name"></upload-modal>
    </div>
{% endblock %}
